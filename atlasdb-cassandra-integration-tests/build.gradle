apply plugin: 'org.inferred.processors'

apply from: "../gradle/shared.gradle"

dependencies {
  testCompile project(":atlasdb-cassandra")
  testCompile project(":atlasdb-tests-shared")
  testCompile project(":atlasdb-container-test-utils")
  testCompile project(":atlasdb-docker-test-utils")
  testCompile project(":atlasdb-ete-test-utils")

  testCompile 'org.apache.cassandra:cassandra-all:' + libVersions.cassandra
  testCompile 'com.datastax.cassandra:cassandra-driver-core:' + libVersions.cassandra_driver_core

  testCompile 'org.mockito:mockito-core:' + libVersions.mockito
  testCompile 'com.palantir.docker.compose:docker-compose-rule:' + libVersions.dockerComposeRule

  def cassVer;

  gradle.taskGraph.whenReady { taskGraph ->
    if (taskGraph.hasTask(testV3)) {
      cassVer = "3.7"
    } else {
      cassVer = "2.2.8"
    }
  }

  test.doFirst {
    println "Using cassandra version $cassVer"
    environment "CASSANDRA_VERSION", "$cassVer"
  }

  task testV3(dependsOn: test) {
  }
}
